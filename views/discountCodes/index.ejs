<%- include('../partials/header', { title: 'Promo Codes' }) %>
<%- include('../partials/navbar', { user: locals.user }) %>

<div class="container">
  <div class="content-card">
    <div class="section-heading mb-3 d-flex justify-content-between align-items-center flex-wrap gap-2">
      <div>
        <p class="eyebrow mb-1">Promotions</p>
        <h2 class="mb-0">Discount Codes</h2>
        <p class="muted mb-0">Manage codes, limits, and expiry.</p>
      </div>
      <a href="/admin/discount-codes/create" class="btn btn-sm btn-primary">Create code</a>
    </div>

    <% if (success && success.length) { %>
      <div class="alert alert-success"><%= success[0] %></div>
    <% } %>
    <% if (error && error.length) { %>
      <div class="alert alert-danger"><%= error[0] %></div>
    <% } %>

    <div class="table-responsive table-card">
      <table class="table align-middle mb-0">
        <thead>
          <tr>
            <th>Code</th>
            <th>Description</th>
            <th>% Off</th>
            <th>$ Off</th>
            <th>Uses Left</th>
            <th>Expires</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% codes.forEach(function(c){ %>
            <tr>
              <td><strong><%= c.code %></strong></td>
              <td><%= c.description %></td>
              <td><%= c.percent_off || '' %></td>
              <td><%= c.amount_off || '' %></td>
              <td><%= c.uses_remaining === null ? 'âˆž' : c.uses_remaining %></td>
              <td><%= c.expires_at ? new Date(c.expires_at).toLocaleDateString() : 'No expiry' %></td>
              <td>
                <span class="badge <%= c.active ? 'bg-success' : 'bg-secondary' %>">
                  <%= c.active ? 'Active' : 'Inactive' %>
                </span>
              </td>
              <td class="d-flex gap-2">
                <a href="/admin/discount-codes/edit/<%= c.id %>" class="btn btn-sm btn-light">Edit</a>
                <form action="/admin/discount-codes/delete/<%= c.id %>" method="POST" onsubmit="return confirm('Delete discount code <%= c.code %>?');" class="m-0">
                  <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                </form>
              </td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>
